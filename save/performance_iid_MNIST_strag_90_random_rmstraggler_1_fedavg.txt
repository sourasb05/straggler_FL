----------Experiment---------
Namespace(adaptiveness=5, dataset='mnist', epoch=30, frac=0.2, gpu=None, iid=0, kernel_num=9, kernel_sizes='3,4,5', l_batch=128, l_epoch=20, lr=0.01, max_pool='True', method='fedavg', model='cnn', mu=0.01, n_classes=10, n_equal=0, norm='batch_norm', num_channels=1, num_filters=32, num_users=100, optimizer='sgd', rm_straggler=1, seed=0, stop=10, straggler_frac=0.9, user_type=0, verbose=1)
 Model : cnn

 Optimizer : sgd
 learning rate : 0.01
 Global Rounds : 30
 Federated settings
Dataset : IID
Fraction of participating users: 0.2
method : fedavg
Proximal term constant 0.01
Local batch size: 128
Local epochs: 20
straggler_frac: 0.9
data division is random

 | Global Training Round : 1 |

straggler free nodes =  1
/home/soura/WASP-Phd/straggler-mitigation-fl/code/model_update.py:22: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  return torch.tensor(image), torch.tensor(label)
participants list [[50, 9]]
 
Avg validation Stats after 1 global rounds:
Validation Loss : 2.1064231227636334
Validation Accuracy: 40.45% 

Validation loss decreased (inf --> 2.106423).  Saving model ...

 | Global Training Round : 2 |

straggler free nodes =  1
participants list [[88, 7]]
 
Avg validation Stats after 2 global rounds:
Validation Loss : 1.1005833009183406
Validation Accuracy: 76.10% 

Validation loss decreased (2.106423 --> 1.100583).  Saving model ...

 | Global Training Round : 3 |

straggler free nodes =  1
participants list [[30, 2]]
 
Avg validation Stats after 3 global rounds:
Validation Loss : 0.6455079639106986
Validation Accuracy: 82.13% 

Validation loss decreased (1.100583 --> 0.645508).  Saving model ...

 | Global Training Round : 4 |

straggler free nodes =  1
participants list [[58, 8]]
 
Avg validation Stats after 4 global rounds:
Validation Loss : 0.5008769515044987
Validation Accuracy: 84.28% 

Validation loss decreased (0.645508 --> 0.500877).  Saving model ...

 | Global Training Round : 5 |

straggler free nodes =  1
participants list [[1, 2]]
 
Avg validation Stats after 5 global rounds:
Validation Loss : 0.3967397140786052
Validation Accuracy: 88.37% 

Validation loss decreased (0.500877 --> 0.396740).  Saving model ...

 | Global Training Round : 6 |

straggler free nodes =  1
participants list [[15, 2]]
 
Avg validation Stats after 6 global rounds:
Validation Loss : 0.35759525497443967
Validation Accuracy: 89.83% 

Validation loss decreased (0.396740 --> 0.357595).  Saving model ...

 | Global Training Round : 7 |

straggler free nodes =  1
participants list [[70, 2]]
 
Avg validation Stats after 7 global rounds:
Validation Loss : 0.3050115153635851
Validation Accuracy: 90.85% 

Validation loss decreased (0.357595 --> 0.305012).  Saving model ...

 | Global Training Round : 8 |

straggler free nodes =  1
participants list [[72, 5]]
 
Avg validation Stats after 8 global rounds:
Validation Loss : 0.2889689468410797
Validation Accuracy: 91.13% 

Validation loss decreased (0.305012 --> 0.288969).  Saving model ...

 | Global Training Round : 9 |

straggler free nodes =  1
participants list [[62, 20]]
 
Avg validation Stats after 9 global rounds:
Validation Loss : 0.26267930157389485
Validation Accuracy: 92.47% 

Validation loss decreased (0.288969 --> 0.262679).  Saving model ...

 | Global Training Round : 10 |

straggler free nodes =  1
participants list [[68, 3]]
 
Avg validation Stats after 10 global rounds:
Validation Loss : 0.23875350462878125
Validation Accuracy: 92.92% 

Validation loss decreased (0.262679 --> 0.238754).  Saving model ...

 | Global Training Round : 11 |

straggler free nodes =  1
participants list [[30, 9]]
 
Avg validation Stats after 11 global rounds:
Validation Loss : 0.23446543029765599
Validation Accuracy: 92.83% 

Validation loss decreased (0.238754 --> 0.234465).  Saving model ...

 | Global Training Round : 12 |

straggler free nodes =  1
participants list [[25, 2]]
 
Avg validation Stats after 12 global rounds:
Validation Loss : 0.23177224070567173
Validation Accuracy: 92.97% 

Validation loss decreased (0.234465 --> 0.231772).  Saving model ...

 | Global Training Round : 13 |

straggler free nodes =  1
participants list [[21, 20]]
 
Avg validation Stats after 13 global rounds:
Validation Loss : 0.2139890230555321
Validation Accuracy: 93.67% 

Validation loss decreased (0.231772 --> 0.213989).  Saving model ...

 | Global Training Round : 14 |

straggler free nodes =  1
participants list [[66, 4]]
 
Avg validation Stats after 14 global rounds:
Validation Loss : 0.198771551686048
Validation Accuracy: 94.02% 

Validation loss decreased (0.213989 --> 0.198772).  Saving model ...

 | Global Training Round : 15 |

straggler free nodes =  1
participants list [[37, 1]]
 
Avg validation Stats after 15 global rounds:
Validation Loss : 0.19542472866008762
Validation Accuracy: 93.90% 

Validation loss decreased (0.198772 --> 0.195425).  Saving model ...

 | Global Training Round : 16 |

straggler free nodes =  1
participants list [[86, 7]]
 
Avg validation Stats after 16 global rounds:
Validation Loss : 0.19099264720390782
Validation Accuracy: 94.30% 

Validation loss decreased (0.195425 --> 0.190993).  Saving model ...

 | Global Training Round : 17 |

straggler free nodes =  1
participants list [[38, 8]]
 
Avg validation Stats after 17 global rounds:
Validation Loss : 0.18355925043130994
Validation Accuracy: 94.33% 

Validation loss decreased (0.190993 --> 0.183559).  Saving model ...

 | Global Training Round : 18 |

straggler free nodes =  1
participants list [[36, 2]]
 
Avg validation Stats after 18 global rounds:
Validation Loss : 0.17444479131998375
Validation Accuracy: 94.68% 

Validation loss decreased (0.183559 --> 0.174445).  Saving model ...

 | Global Training Round : 19 |

straggler free nodes =  1
participants list [[99, 4]]
 
Avg validation Stats after 19 global rounds:
Validation Loss : 0.1690875882365509
Validation Accuracy: 95.00% 

Validation loss decreased (0.174445 --> 0.169088).  Saving model ...

 | Global Training Round : 20 |

straggler free nodes =  1
participants list [[28, 5]]
 
Avg validation Stats after 20 global rounds:
Validation Loss : 0.16619409599326904
Validation Accuracy: 94.87% 

Validation loss decreased (0.169088 --> 0.166194).  Saving model ...

 | Global Training Round : 21 |

straggler free nodes =  1
participants list [[58, 1]]
 
Avg validation Stats after 21 global rounds:
Validation Loss : 0.16144847413810937
Validation Accuracy: 95.42% 

Validation loss decreased (0.166194 --> 0.161448).  Saving model ...

 | Global Training Round : 22 |

straggler free nodes =  1
participants list [[13, 9]]
 
Avg validation Stats after 22 global rounds:
Validation Loss : 0.16942442330289487
Validation Accuracy: 94.95% 

EarlyStopping counter: 1 out of 10

 | Global Training Round : 23 |

straggler free nodes =  1
participants list [[64, 8]]
 
Avg validation Stats after 23 global rounds:
Validation Loss : 0.15306529215614145
Validation Accuracy: 95.63% 

Validation loss decreased (0.161448 --> 0.153065).  Saving model ...

 | Global Training Round : 24 |

straggler free nodes =  1
participants list [[10, 9]]
 
Avg validation Stats after 24 global rounds:
Validation Loss : 0.14906213160118933
Validation Accuracy: 95.53% 

Validation loss decreased (0.153065 --> 0.149062).  Saving model ...

 | Global Training Round : 25 |

straggler free nodes =  1
participants list [[69, 10]]
 
Avg validation Stats after 25 global rounds:
Validation Loss : 0.14470338530690058
Validation Accuracy: 95.60% 

Validation loss decreased (0.149062 --> 0.144703).  Saving model ...

 | Global Training Round : 26 |

straggler free nodes =  1
participants list [[37, 10]]
 
Avg validation Stats after 26 global rounds:
Validation Loss : 0.1503397359389783
Validation Accuracy: 95.43% 

EarlyStopping counter: 1 out of 10

 | Global Training Round : 27 |

straggler free nodes =  1
participants list [[64, 3]]
 
Avg validation Stats after 27 global rounds:
Validation Loss : 0.14902082173136655
Validation Accuracy: 95.65% 

EarlyStopping counter: 2 out of 10

 | Global Training Round : 28 |

straggler free nodes =  1
participants list [[58, 4]]
 
Avg validation Stats after 28 global rounds:
Validation Loss : 0.14478083108268033
Validation Accuracy: 95.95% 

EarlyStopping counter: 3 out of 10

 | Global Training Round : 29 |

straggler free nodes =  1
participants list [[29, 5]]
 
Avg validation Stats after 29 global rounds:
Validation Loss : 0.14806921739908468
Validation Accuracy: 95.58% 

EarlyStopping counter: 4 out of 10

 | Global Training Round : 30 |

straggler free nodes =  1
participants list [[43, 5]]
 
Avg validation Stats after 30 global rounds:
Validation Loss : 0.13419007306255662
Validation Accuracy: 96.03% 

Validation loss decreased (0.144703 --> 0.134190).  Saving model ...
precision: 0.9630869884744607
recall 0.962840943369508
accuracy 0.9631
F1 score 0.9628578668434578
correct : 9631.0
total : 10000.0
test loss now: 0.11597130481666544
bnatch index: 79
 
 Results after 30 global rounds of training:
 Train loss:  [2.245727947354317, 1.8135324656963348, 1.151408924907446, 0.8940599463880062, 0.7489678673446178, 0.5925814341753721, 0.5615906102582813, 0.5263012679293751, 0.4842327956110239, 0.4973653331398964, 0.45021913535892966, 0.3926806332543492, 0.3841937629505992, 0.43043376244604586, 0.41881010942161084, 0.3509590391069651, 0.4156388225033879, 0.39493542425334455, 0.3346165033522993, 0.3420409856364131, 0.3322140982374549, 0.29733520178124306, 0.2820228273048997, 0.3047405109740794, 0.3416329395025969, 0.30425007799640297, 0.23209639480337502, 0.2768097071908414, 0.2410934805870056, 0.2742994697764516]
 Validation loss:  [2.1064231227636334, 1.1005833009183406, 0.6455079639106986, 0.5008769515044987, 0.3967397140786052, 0.35759525497443967, 0.3050115153635851, 0.2889689468410797, 0.26267930157389485, 0.23875350462878125, 0.23446543029765599, 0.23177224070567173, 0.2139890230555321, 0.198771551686048, 0.19542472866008762, 0.19099264720390782, 0.18355925043130994, 0.17444479131998375, 0.1690875882365509, 0.16619409599326904, 0.16144847413810937, 0.16942442330289487, 0.15306529215614145, 0.14906213160118933, 0.14470338530690058, 0.1503397359389783, 0.14902082173136655, 0.14478083108268033, 0.14806921739908468, 0.13419007306255662]
 Validation accuracy:  [40.449999999999974, 76.1, 82.13333333333334, 84.28333333333332, 88.36666666666669, 89.83333333333337, 90.85000000000008, 91.13333333333335, 92.46666666666671, 92.91666666666674, 92.83333333333339, 92.96666666666671, 93.66666666666671, 94.01666666666675, 93.90000000000009, 94.30000000000003, 94.33333333333336, 94.68333333333342, 95.00000000000007, 94.86666666666673, 95.41666666666673, 94.95000000000006, 95.6333333333334, 95.53333333333343, 95.60000000000008, 95.43333333333342, 95.65000000000008, 95.9500000000001, 95.58333333333341, 96.03333333333342]
 Test Accuracy: 96.31%
 Test loss: 0.12

 Total Run Time: 148.4104

